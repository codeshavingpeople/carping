<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="FoodZoneMapper">
	
	<resultMap type="FoodZone" id="FoodZoneResultMap">
		<id property="foodZoneKey" column="FOODZONE_KEY"/>
		<result property="foodZoneName" column="FOODZONE_NAME"/>
		<result property="foodZoneAddress" column="FOODZONE_ADDRESS"/>
		<result property="foodZoneGeoCode" column="FOODZONE_GEOCODE"/>
		<result property="foodZonePhone" column="FOODZONE_PHONE"/>
		<result property="foodZoneImage" column="FOODZONE_IMAGE"/>
		<result property="foodZoneEtc" column="FOODZONE_ETC"/>
		<result property="scoreAvg" column="SCOREAVG"/>
		<result property="takeOutStatus" column="TAKEOUT_STATUS"/>
	</resultMap>

	<resultMap type="FoodZoneReview" id="FoodZoneReviewResultMap">
		<id property="frKey" column="FR_KEY"/>
		<result property="foodZoneKey" column="FOODZONE_KEY"/>
		<result property="frScore" column="FR_SCORE"/>
		<result property="frTitle" column="FR_TITLE"/>
		<result property="frContent" column="FR_CONTENT"/>
		<result property="frRegDate" column="FR_REGDATE"/>
		<result property="frHits" column="FR_HITS"/>
		<result property="frPhoto" column="FR_PHOTO"/>
		<result property="memberId" column="MEMBER_ID"/>
	</resultMap>
	
	<resultMap type="TakeOut" id="TakeOutResultMap">
		<id property="takeOutKey" column="TAKEOUT_KEY"/>
		<result property="foodZoneKey" column="FOODZONE_KEY"/>
		<result property="takeOutMenu" column="TAKEOUT_MENU"/>
		<result property="takeOutMenuPrice" column="TAKEOUT_MENU_PRICE"/>
		<result property="takeOutMenuPhoto" column="TAKEOUT_MENU_PHOTO"/>
	</resultMap>
	
	<resultMap type="TakeOutReserve" id="TakeOutReserveResultMap">
		<id property="torKey" column="TOR_KEY"></id>
		<result property="memberId" column="MEMBER_ID"/>
		<result property="takeOutKey" column="TAKEOUT_KEY"/>
		<result property="torEa" column="TOR_EA"/>
		<result property="torPrice" column="TOR_PRICE"/>
		<result property="torRegDate" column="TOR_REGDATE"/>
		<result property="torTime" column="TOR_TIME"/>
	</resultMap>
	<select id="selectAll" resultMap="FoodZoneResultMap">
		SELECT * FROM FOODZONE
	</select>
	
	<select id="selectOneFoodZone" resultMap="FoodZoneResultMap">
		SELECT * FROM FOODZONE WHERE FOODZONE_NAME = #{foodZoneName}
	</select>
	<select id="getListCount" resultType="int">
		SELECT COUNT(*) FROM FOOD_REVIEW WHERE	FOODZONE_KEY = #{foodZoneKey}
	</select>
	<select id="selectReviewList" resultMap="FoodZoneReviewResultMap">
		SELECT * FROM (select * from FOOD_REVIEW ORDER BY 6 DESC) WHERE FOODZONE_KEY = #{foodZoneKey} AND 3>=ROWNUM
	</select>

	<select id="selectFoodZoneAvg" resultType="double">
		SELECT ROUND(AVG(FR_SCORE),1) FROM FOOD_REVIEW WHERE FOODZONE_KEY = #{foodZoneKey}
	</select>
	
	<select id="takeOutMenuAll" resultMap="TakeOutResultMap">
		SELECT * FROM TAKEOUTMENU WHERE FOODZONE_KEY=#{foodZoneKey}
	</select>
	
	<select id="searchList" resultMap="FoodZoneResultMap">
		SELECT * FROM FOODZONE 
		<where>
			<if test="searchCondition.toString() == '맛집이름'">
				FOODZONE_NAME LIKE '%' || #{searchValue} || '%'
			</if>
			
			<if test="searchCondition.toString() == '주소'">
				FOODZONE_ADDRESS LIKE '%' || #{searchValue} || '%'
			</if>
		</where>
	</select>
	
	<select id="getFoodZoneReviewListCount" resultType="int">
		SELECT COUNT(*) FROM FOOD_REVIEW WHERE FOODZONE_KEY = #{foodZoneKey} 
	</select>
	
	<select id="selectFoodZoneReviewList" resultMap="FoodZoneReviewResultMap">
		SELECT * FROM FOOD_REVIEW WHERE FOODZONE_KEY = #{foodZoneKey} ORDER BY 6 DESC
	</select>
</mapper>
